(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesReserve/proBuy/proBuy"],{"57ba":function(e,t,a){"use strict";a.r(t);var n=a("c678"),i=a.n(n);for(var o in n)"default"!==o&&function(e){a.d(t,e,function(){return n[e]})}(o);t["default"]=i.a},"6d27":function(e,t,a){"use strict";a.r(t);var n=a("cd5a"),i=a("57ba");for(var o in i)"default"!==o&&function(e){a.d(t,e,function(){return i[e]})}(o);a("c065");var s,r=a("f0c5"),d=Object(r["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);t["default"]=d.exports},"8db8":function(e,t,a){},a946:function(e,t,a){"use strict";(function(e){a("d28f");n(a("66fd"));var t=n(a("6d27"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("5486")["createPage"])},c065:function(e,t,a){"use strict";var n=a("8db8"),i=a.n(n);i.a},c678:function(e,t,a){"use strict";(function(e){function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a("88e4"),o={data:function(){return{$imgurl:this.$imgurl,$host:this.$host,baseinfo:"",id:"",bg:"",couponlist:[],picList:[],datas:{},comment:"",jhsl:1,dprice:"",yhje:0,hjjg:0,sfje:0,order:"",pro_name:"",pro_tel:"",pro_address:"",pro_txt:"",my_num:"",xg_num:"",shengyu:"",userInfo:"",chuydate:"选择日期",chuytime:"选择时间",num:{},duogg:[],xz_num:[],couponprice:0,jqdjg:"请选择",yhqid:"0",oldsfje:"",pagedata:{},imgcount_xz:0,pagedata_set:[],zhixin:!1,xuanz:0,lixuanz:-1,ttcxs:0,chooseNum:0,myscore:0,jifen_u:2,zf_money:0,dkmoney:0,type:"",testKey:"",testKeys:"",order_id:"",pd_val:[],formId:"",sw:!1,showModalStatus:!1,zf_type:0,mymoney:0,show_pay_type:0,h5pay:0,dopay:"",pay_type:1,alipay:1,wxpay:1,needBind:!1,needAuth:!1,dkscore:0,xx:[],arrs:[],wxmobile:"",myname:"",mymobile:"",myaddress:"",discounts:0,ischecked:!1,storeall:"",storeid:"",is_submit:1}},onLoad:function(e){var t=this,a=e.id;t.id=a,void 0!=e.testPrice&&(t.testPrice=e.testPrice),void 0!=e.testKey&&(t.testKey=e.testKey),void 0!=e.testKeys&&(t.testKeys=e.testKeys),"table"==e.type&&(t.type=e.type,t.NowSelectStr=e.NowSelectStr,t.appoint_date=e.appoint_date);var n=0;e.fxsid&&(n=e.fxsid),this.fxsid=n,this._baseMin(this),i.bdLogin(n,function(){var e=t.id;t.getShowPic(e)})},methods:{closeAuth:function(){this.needAuth=!1,this._checkBindPhone(this)},closeBind:function(){this.needBind=!1,this.getShowPic(this.id)},getStore:function(e){this.storeid=e.currentTarget.dataset.id},getShowPic:function(t){var a=this;e.getStorageSync("openid");e.request({url:a.$baseurl+"doPagemycoupon",data:{suid:e.getStorageSync("suid"),flag:0,uniacid:a.$uniacid,id:a.id,type:"yuyue"},success:function(e){a.couponlist=e.data.data},fail:function(e){}}),e.request({url:a.$baseurl+"doPageshowPro",data:{id:t,suid:e.getStorageSync("suid"),uniacid:a.$uniacid},cachetime:"30",success:function(t){var n=t.data.data.userinfo.grade,i=t.data.data.stores;""!=i&&(a.storeall=i,a.storeid=i[0]["id"]);var o=t.data.data.discount_status;if(n>0&&o>0){var s=t.data.data.discount;if(2==o){if(s.length>0)for(var r=0;r<s.length;r++)if(n==s[r]["grade"]){var d=s[r]["discount"];break}}else d=s}else d=0;var c=t.data.data.userinfo.money,u=t.data.data.userinfo.score;t.data.data.price;if("table"!=a.type){var l=a.yhje;if(0==t.data.data.pro_xz)f=1;else var f=t.data.data.pro_xz-t.data.data.my_num;var h=t.data.data.more_type_x,y=[],p={},g=0;for(r=0;r<h.length;r++)p[r]=0,y.push(p),g+=0*h[r][1];a.bg=t.data.data.text[0],a.picList=t.data.data.text,a.title=t.data.data.title,a.datas=t.data.data,a.duogg=h,a.hjjg=g,a.zf_money=g,a.dprice=g,a.sfje=g-l,a.myscore=parseFloat(t.data.data.userinfo.score),a.mymoney=parseFloat(t.data.data.userinfo.money),a.xz_num=t.data.data.more_type_num,a.num=y,a.xg_num=t.data.data.pro_xz,a.shengyu=t.data.data.pro_kc,a.xg_buy=f,a.pagedata=t.data.data.forms,a.formdescs=t.data.data.formdescs,a.discounts=d;var m=a.testKey;""!=m&&a.jia();var v=a.testKeys;if(console.log(v),1==v&&h.length>0)for(r=0;r<h.length;r++)a.testPrice=h[r][1],a.testKey=r,a.jia()}else{l=a.yhje;var _,x,w=a.NowSelectStr.split(","),j=w.length;for(r=0;r<j;r++)_=w[r].split("a"),x=t.data.data.table.rowstr[_[0]-1]+"，",x+=t.data.data.table.columnstr[_[1]-1],w[r]=x;a.myscore=u,a.mymoney=c,a.select_arr=w,a.bg=t.data.data.text[0],a.title=t.data.data.title,a.datas=t.data.data,a.hjjg=t.data.data.price*j,a.zf_money=t.data.data.price*j,a.dprice=t.data.data.price,a.select_num=j,a.sfje=Math.floor(100*(t.data.data.price*j-l))/100,a.pagedata=t.data.data.forms,a.formdescs=t.data.data.formdescs,a.discounts=d}e.setNavigationBarTitle({title:a.title}),e.setStorageSync("isShowLoading",!1),e.hideNavigationBarLoading(),e.stopPullDownRefresh(),e.request({url:a.$baseurl+"doPagegetmoneyoff",data:{uniacid:a.$uniacid},success:function(e){for(var t=e.data.data,n="",i=0;i<t.length;i++)i==t.length-1?n+="满"+t[i].reach+"减"+t[i].del:n+="满"+t[i].reach+"减"+t[i].del+"，";a.sfje;a.moneyoff=t,a.moneyoffstr=t?n:"",a.getmyinfo()}})}})},getmyinfo:function(){var t=this,a=(e.getStorageSync("openid"),t.moneyoff),n=t.hjjg,i=t.discounts;if(i>0&&n>0)if(n=n*i/10,n<.01)n=.01;else{var o=String(n).indexOf(".")+1,s=String(n).length-o;if(s>2){var r=n.toFixed(2),d=n.toFixed(3),c=(d-r).toFixed(3);n=.005!=c?r:1*r+.01}else n=n.toFixed(2)}if(a)for(var u=a.length-1;u>=0;u--)if(n>=parseFloat(a[u].reach)){n-=parseFloat(a[u].del);break}t.sfje=n,t.zf_type=parseFloat(t.mymoney)>=n?0:1,t.zf_money=parseFloat(t.mymoney)>=n?n:Math.round(100*(n-t.mymoney))/100},jian:function(e){var t=this,a=(t.yhje,e.currentTarget.dataset.testid),n=e.currentTarget.dataset.testkey,i=t.num[n][n],o=(t.duogg,t.sfje),s=t.oldsfje,r=t.hjjg;if(i--,i<0)i=0;else{var d=Math.round(100*s-100*a*i+100*a*(i-1))/100;o=d,r=d,s=d;var c=t.num;c[n][n]=i;var u=t.chooseNum-1;t.num=c,t.sfje=o,t.hjjg=r,t.jqdjg="请选择",t.oldsfje=s,t.yhqid=0,t.chooseNum=u,t.ischecked=!1,t.dkscore=0,t.dkmoney=0,t.jifen_u=2,t.getmyinfo()}},jia:function(t){var a=this;a.yhje;if(void 0==t){var n=a.testKey;if(""!==n)var i=a.testPrice}else i=t.currentTarget.dataset.testid,n=t.currentTarget.dataset.testkey;var o=a.num[n][n],s=(a.duogg,a.sfje,a.oldsfje),r=a.hjjg,d=a.xz_num,c=d[n].shennum;if(o++,o>c)return o--,e.showModal({title:"提醒",content:"库存量不足！",showCancel:!1}),!1;var u=Math.round(100*i*o+100*s-100*i*(o-1))/100;s=u,r=u;var l=a.num;a.datas;l[n][n]=o;var f=a.chooseNum+1;a.num=l,a.hjjg=r,a.jqdjg="请选择",a.oldsfje=s,a.yhqid=0,a.chooseNum=f,a.ischecked=!1,a.dkscore=0,a.dkmoney=0,a.jifen_u=2,a.getmyinfo()},changealipay:function(){this.pay_type=1},changewxpay:function(){this.pay_type=2},close_pay_type:function(){this.show_pay_type=0,e.navigateTo({url:"/pagesReserve/orderList/orderList"})},h5topay:function(){var e=this.pay_type;1==e?this.pay3(this.orderid):2==e&&this.pay5(this.orderid),this.show_pay_type=0},pay3:function(t){var a,i=this;console.log("支付宝H5支付"),e.request({url:this.$baseurl+"doPageHfivepay",data:(a={uniacid:this.$uniacid,order_id:t,suid:e.getStorageSync("suid"),types:9},n(a,"suid",e.getStorageSync("suid")),n(a,"money",i.zf_money),a),success:function(a){1==a.data.flag&&e.navigateTo({url:"/pages/aliH5pay/aliH5pay?id="+t+"&type=9"})}})},pay5:function(t){var a=this;console.log("微信H5支付"),e.request({url:this.$baseurl+"doPageHfiveWxpay",data:{uniacid:this.$uniacid,order_id:t,types:"reserve",suid:e.getStorageSync("suid"),money:a.zf_money},success:function(a){a.data&&(console.log(a.data),e.setStorageSync(t,a.data.mweb_url),e.navigateTo({url:"/pages/wxH5pay/wxH5pay?order_id="+t}))}})},userNameInput:function(e){this.pro_name=e.detail.value},userTelInput:function(e){this.pro_tel=e.detail.value},userAddInput:function(e){this.pro_address=e.detail.value},userTextInput:function(e){this.pro_txt=e.detail.value},submit:i.throttle(function(t){var a=this,n=this.is_submit;if(2==n)return!1;var i=a.jhsl,o=a.shengyu,s=a.type,r=t.detail.formId;if(a.formId=r,i>o&&-1!=o&&"table"!=s)return i--,e.showModal({title:"提醒",content:"库存量不足！",showCancel:!1}),!1;var d=a.sfje,c=e.getStorageSync("openid"),u=(a.duogg,a.num),l=a.chuydate,f=a.chuytime,h=(a.yhje,a.id),y=a.order,p=a.pro_name,g=a.pro_tel,m=a.pro_address,v=a.pro_txt,_=(a.id,a.yhqid),x=!0,w=a.hjjg,j="table"==s?a.select_num:a.chooseNum;if(0==j)return x=!1,e.showModal({title:"提醒",content:"您至少要选择1个产品或服务",showCancel:!1}),!1;if(!p&&2==a.datas.pro_flag)return x=!1,e.showModal({title:"提醒",content:"姓名为必填！",showCancel:!1}),!1;var b=/^(((13[0-9]{1})|(14[0-9]{1})|(15[0-9]{1})|(16[0-9]{1})|(17[0-9]{1})|(18[0-9]{1})|(19[0-9]{1}))+\d{8})$/;if(!g&&2==a.datas.pro_flag_tel)return x=!1,e.showModal({title:"提醒",content:"手机号为必填！",showCancel:!1}),!1;if(!b.test(g)&&2==a.datas.pro_flag_tel)return e.showModal({title:"提醒",content:"请输入有效的手机号码！",showCancel:!1}),!1;if(!m&&2==a.datas.pro_flag_add)return x=!1,e.showModal({title:"提醒",content:"地址为必填！",showCancel:!1}),!1;if(0==a.datas.tableis){if("选择日期"==l&&2==a.datas.pro_flag_data)return x=!1,e.showModal({title:"提醒",content:"请选择日期！",showCancel:!1}),!1;if("选择时间"==f&&2==a.datas.pro_flag_time)return x=!1,e.showModal({title:"提醒",content:"请选择时间！",showCancel:!1}),!1}for(var S=a.pagedata,z=0;z<S.length;z++){if(1==S[z].ismust)if(5==S[z].type){if(""==S[z].z_val)return x=!1,e.showModal({title:"提醒",content:S[z].name+"为必填项！",showCancel:!1}),!1}else{if(""==S[z].val)return x=!1,e.showModal({title:"提醒",content:S[z].name+"为必填项！",showCancel:!1}),!1;if(0==S[z].type&&1==S[z]["tp_text"][0]["yval"]){var k=/^1[3456789]{1}\d{9}$/;if(!k.test(S[z].val))return e.showModal({title:"提醒",content:"请您输入正确的手机号码",showCancel:!1}),!1}else if(0==S[z].type&&7==S[z]["tp_text"][0]["yval"]){var M=/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/;if(!M.test(S[z].val))return e.showModal({title:"提醒",content:"请您输入正确的身份证号",showCancel:!1}),!1}}if(5==S[z].type&&S[z].z_val.length>0)for(var P=0;P<S[z].z_val.length;P++){var T=S[z].z_val[P].substr(S[z].z_val[P].indexOf("/upimages"));S[z].z_val[P]=T}}if(this.is_submit=2,x){var $="",q="",C="",N="";if(""==a.storeall)$=a.baseinfo.name,q=a.baseinfo.tel,C=a.baseinfo.address;else{var F=a.storeid,L=a.storeall;for(z=0;z<L.length;z++)if(F==L[z]["id"]){$=L[z]["title"],q=L[z]["tel"],C=L[z]["province"]+L[z]["city"]+L[z]["country"],N=L[z]["times"];break}}e.request({url:a.$baseurl+"doPagecreateorder",data:{types:"reserve",suid:e.getStorageSync("suid"),num:JSON.stringify(u[0]),id:h,hjjg:w,zhifu:d,zf_money:a.zf_money,zf_type:a.zf_type,order:y,pro_name:p,pro_tel:g,pro_address:m,pro_txt:v,chuydate:l,chuytime:f,yhqid:_,type:"table"==a.type?"table":"",NowSelectStr:a.NowSelectStr,appoint_date:a.appoint_date,dkscore:a.dkscore,dkmoney:a.dkmoney,pagedata:JSON.stringify(S),uniacid:a.$uniacid,fid:a.datas.formset,source:e.getStorageSync("source"),openid:c,discounts:a.discounts,store_name:$,store_tel:q,store_address:C,store_hours:N},header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){if("1"==t.data.data.errcode)return e.showModal({title:t.data.data.err,content:"请重新下单",showCancel:!1}),!1;if("3"==t.data.data.errcode)return e.showModal({title:t.data.data.err,content:"当前库存为"+t.data.data.kc+"件",showCancel:!1}),!1;var n=t.data.data.orderid;a.orderid=n,d<=a.mymoney?a.pay1(n):a._baidupay(a,a.zf_money,"reserve",n,"/pagesReserve/orderList/orderList")}})}},2e3),showpay:function(){this.money=this.zf_money-this.mymoney;var t=this;e.request({url:this.$baseurl+"doPageGetH5payshow",data:{uniacid:this.$uniacid,suid:e.getStorageSync("suid")},success:function(a){0==a.data.data.ali&&0==a.data.data.wx?e.showModal({title:"提示",content:"请联系管理员设置支付参数",showCancel:!1,success:function(e){return!1}}):(0==a.data.data.ali?(t.alipay=0,t.pay_type=2):(t.alipay=1,t.pay_type=1),0==a.data.data.wx?t.wxpay=0:t.wxpay=1,t.show_pay_type=1)}})},bindDateChange2:function(e){this.chuydate=e.detail.value},bindTimeChange2:function(e){this.chuytime=e.detail.value},getmoney:function(t){var a=this,n=t.currentTarget.dataset.price,i=t.currentTarget.dataset.index,o=i["pay_money"],s=i["id"],r=a.discounts;if(0==r)var d=a.hjjg;else if(r>0)d=(a.hjjg*r).toFixed(2);if(1*d<1*o)e.showModal({title:"提示",content:"价格未满"+o+"元，不可使用该优惠券！",showCancel:!1});else{var c=(100*a.sfje-100*parseFloat(n)+100*a.dkmoney)/100;a.ischecked=!1,a.switchChange("false");var u=parseFloat(c.toPrecision(12));u<0&&(u=0),a.jqdjg=n,console.log(n),a.yhqid=s,a.sfje=u,a.oldsfje=d,a.zf_type=parseFloat(a.mymoney)>=parseFloat(u)?0:1,a.zf_money=parseFloat(a.mymoney)>=parseFloat(u)?parseFloat(u):Math.round(100*(parseFloat(u)-parseFloat(a.mymoney)))/100}a.hideModal()},qxyh:function(){var e=this,t=e.jqdjg;"请选择"==t&&(t=0);var a=e.sfje,n=Math.round(100*a+100*t)/100;e.hideModal(),e.jqdjg=0,e.yhqid=0,e.sfje=n,e.jqdjg="请选择"},showModal:function(){this.showModalStatus=!0},hideModal:function(){this.showModalStatus=!1},bindInputChange:function(e){var t=this,a=e.detail.value,n=e.currentTarget.dataset.index,i=t.pagedata;i[n].val=a,t.pagedata=i},bindPickerChange:function(e){var t=this,a=e.detail.value,n=e.currentTarget.dataset.index,i=t.pagedata,o=i[n].tp_text,s=o[a];i[n].val=s,t.pagedata=i},bindDateChange:function(e){var t=this,a=e.detail.value,n=e.currentTarget.dataset.index,i=t.pagedata;i[n].val=a,t.pagedata=i},bindTimeChange:function(e){var t=this,a=e.detail.value,n=e.currentTarget.dataset.index,i=t.pagedata;i[n].val=a,t.pagedata=i},checkboxChange:function(e){var t=this,a=e.detail.value,n=e.currentTarget.dataset.index,i=t.pagedata;i[n].val=a,t.pagedata=i},radioChange:function(e){var t=this,a=e.detail.value,n=e.currentTarget.dataset.index,i=t.pagedata;i[n].val=a,t.pagedata=i},choiceimg:function(t){var a=this,n=0,i=a.zhixin,o=t.currentTarget.dataset.index,s=a.pagedata,r=s[o].val,d=s[o].tp_text[0];r?n=r.length:(n=0,r=[]);var c=d-n,u=a.$baseurl+"wxupimg";a.pd_val;e.chooseImage({count:c,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){i=!0,a.zhixin=i,e.showLoading({title:"图片上传中"});var n=t.tempFilePaths,r=0,d=n.length,c=function t(){e.uploadFile({url:u,filePath:n[r],name:"file",success:function(n){s[o].z_val.push(n.data),a.pagedata=s,r++,r<d?t():(i=!1,a.zhixin=i,e.hideLoading())}})};c()}})},delimg:function(e){var t=this,a=e.currentTarget.dataset.index,n=e.currentTarget.dataset.id,i=t.pagedata,o=i[a].z_val;o.splice(n,1);var s=o.length;0==s&&(o=""),i[a].z_val=o,t.pagedata=i},namexz:function(e){for(var t=this,a=e.currentTarget.dataset.index,n=t.pagedata,i=n[a],o=[],s=0;s<i.tp_text.length;s++){var r={};r["keys"]=i.tp_text[s].yval,r["val"]=1,o.push(r)}t.ttcxs=1,t.formindex=a,t.xx=o,t.xuanz=0,t.lixuanz=-1,t.riqi()},riqi:function(){for(var e=this,t=new Date,a=new Date(t.getTime()),n=a.getFullYear(),i=a.getMonth()+1,o=a.getDate(),s=n+"-"+i+"-"+o,r=e.xx,d=0;d<r.length;d++)r[d].val=1;e.xx=r,e.gettoday(s);var c=[],u=[],l=new Date;for(d=0;d<5;d++){var f=new Date(l.getTime()+24*d*3600*1e3),h=f.getFullYear(),y=f.getMonth()+1,p=f.getDate(),g=y+"月"+p+"日",m=h+"-"+y+"-"+p;c.push(g),u.push(m)}e.arrs=c,e.fallarrs=u,e.today=s},xuanzd:function(e){for(var t=this,a=e.currentTarget.dataset.index,n=t.fallarrs,i=n[a],o=t.xx,s=0;s<o.length;s++)o[s].val=1;t.xuanz=a,t.today=i,t.lixuanz=-1,t.xx=o,t.gettoday(i)},goux:function(e){var t=this,a=e.currentTarget.dataset.index;t.lixuanz=a},gettoday:function(t){var a=this,n=a.id,i="showPro_lv_buy",o=a.formindex,s=a.xx;e.request({url:a.$baseurl+"doPageDuzhan",data:{id:n,types:i,days:t,pagedatekey:o,uniacid:a.$uniacid},header:{"content-type":"application/json"},success:function(e){for(var t=e.data.data,n=0;n<t.length;n++)s[t[n]].val=2;var i=0;t.length==s.length&&(i=1),a.xx=s,a.isover=i}})},save:function(){var t=this,a=t.today,n=t.xx,i=t.lixuanz;if(-1==i)return e.showModal({title:"提现",content:"请选择预约的选项",showCancel:!1}),!1;var o=n[i].keys,s="已选择"+a+"，"+o,r=t.pagedata,d=t.formindex;r[d].val=s,r[d].days=a,r[d].indexkey=d,r[d].xuanx=i,t.ttcxs=0,t.pagedata=r},quxiao:function(){var e=this;e.ttcxs=0},weixinadd:function(){var t=this;e.chooseAddress({success:function(e){for(var a=e.provinceName+" "+e.cityName+" "+e.countyName+" "+e.detailInfo,n=e.userName,i=e.telNumber,o=t.pagedata,s=0;s<o.length;s++)0==o[s].type&&2==o[s].tp_text[0].yval&&(o[s].val=n),0==o[s].type&&3==o[s].tp_text[0].yval&&(o[s].val=i),0==o[s].type&&4==o[s].tp_text[0].yval&&(o[s].val=a);t.myname=n,t.mymobile=i,t.myaddress=a,t.pagedata=o},fail:function(t){e.getSetting({success:function(t){t.authSetting["scope.address"]||e.openSetting({success:function(e){}})}})}})},switchChange:function(t){var a=this;if("false"==t)var n=!1;else n=!a.ischecked;e.getStorageSync("suid");var i=a.sfje,o=0,s=a.type,r="table"==s?a.select_num:a.chooseNum;if(1==n)e.request({url:a.$baseurl+"doPagescoreDeduction",data:{id:a.id,num:r,suid:e.getStorageSync("suid"),is_more:1,uniacid:a.$uniacid},header:{"content-type":"application/json"},success:function(e){var t=e.data;o=t["moneycl"];var n=t["gzmoney"],s=t["gzscore"];if(i<o&&(o=parseInt(i)),0==o)var r=0;else r=o*s/n;i=Math.round(100*(i-o))/100,a.sfje=i,a.dkmoney=o,a.dkscore=r,a.jifen_u=1,a.zf_type=a.mymoney>=i?0:1,a.zf_money=a.mymoney>=i?i:Math.round(100*(i-a.mymoney))/100,a.ischecked=!0}});else{var d=a.zf_money;o=a.dkmoney;d=Math.round(100*d+100*o)/100,i=d,a.dkmoney=0,a.dkscore=0,a.jifen_u=0,a.zf_money=d,a.sfje=i,a.ischecked=!1}},pay1:function(t){var a=this;e.showModal({title:"请注意",content:"您将使用余额支付"+a.sfje+"元",success:function(n){n.confirm?(a.payover_do(t),e.showLoading({title:"下单中...",mask:!0}),setTimeout(function(){e.hideLoading()},3e3)):e.redirectTo({url:"/pagesReserve/orderList/orderList"})},fail:function(t){e.redirectTo({url:"/pagesReserve/orderList/orderList"})}})},pay2:function(t){var a=this,n=(e.getStorageSync("openid"),a.sfje),i=a.zf_money,o=a.hjjg;e.request({url:a.$baseurl+"doPagebeforepay",data:{openid:e.getStorageSync("openid"),suid:e.getStorageSync("suid"),price:o,pay_price:i,true_price:n,order_id:t,types:"reserve",formId:a.formId,uniacid:a.$uniacid},header:{"content-type":"application/json"},success:function(n){var i=[1,2,3,4];-1!=i.indexOf(n.data.data.err)&&e.showModal({title:"支付失败",content:n.data.data.message,showCancel:!1}),0==n.data.data.err&&(e.request({url:a.$baseurl+"doPagesavePrepayid",data:{types:"reserve",order_id:t,prepayid:n.data.data.package,uniacid:a.$uniacid},success:function(e){},fail:function(e){}}),e.requestPayment({timeStamp:n.data.data.timeStamp,nonceStr:n.data.data.nonceStr,package:n.data.data.package,signType:"MD5",paySign:n.data.data.paySign,success:function(t){e.showToast({title:"支付成功",icon:"success",mask:!0,duration:3e3,success:function(t){e.showToast({title:"购买成功！",icon:"success",success:function(){e.navigateTo({url:"/pagesReserve/orderList/orderList"})}})}})},fail:function(t){e.navigateTo({url:"/pagesReserve/orderList/orderList"})},complete:function(e){}}))}})},payover_do:function(t){var a=this,n=a.sfje,i=e.getStorageSync("openid");e.request({url:a.$baseurl+"doPagepaynotify",data:{out_trade_no:t,suid:e.getStorageSync("suid"),openid:i,source:e.getStorageSync("source"),payprice:n,types:"reserve",flag:0,formId:a.formId,uniacid:a.$uniacid},success:function(t){e.showToast({title:"购买成功！",icon:"success",mask:!0,success:function(){e.navigateTo({url:"/pagesReserve/orderList/orderList"})}})}})},refreshSessionkey:function(){var t=this;e.login({success:function(a){e.request({url:t.$baseurl+"doPagegetNewSessionkey",data:{uniacid:t.$uniacid,code:a.code},success:function(e){t.newSessionKey=e.data.data}})}})},getPhoneNumber:function(t){var a=this,n=t.detail.iv,i=t.detail.encryptedData;"getPhoneNumber:ok"==t.detail.errMsg?e.checkSession({success:function(){e.request({url:a.$baseurl+"doPagejiemiNew",data:{uniacid:a.$uniacid,newSessionKey:a.newSessionKey,iv:n,encryptedData:i},success:function(t){if(t.data.data){for(var n=a.pagedata,i=0;i<n.length;i++)0==n[i].type&&5==n[i].tp_text[0].yval&&(n[i].val=t.data.data);a.wxmobile=t.data.data,a.pagedata=n}else e.showModal({title:"提示",content:"sessionKey已过期，请下拉刷新！"})},fail:function(e){}})},fail:function(){e.showModal({title:"提示",content:"sessionKey已过期，请下拉刷新！"})}}):e.showModal({title:"提示",content:"请先授权获取您的手机号！",showCancel:!1})}}};t.default=o}).call(this,a("5486")["default"])},cd5a:function(e,t,a){"use strict";var n={auth:()=>Promise.all([a.e("common/vendor"),a.e("components/auth/auth")]).then(a.bind(null,"a32a")),bindPhone:()=>Promise.all([a.e("common/vendor"),a.e("components/bindPhone/bindPhone")]).then(a.bind(null,"9bb9"))},i=function(){var e=this,t=e.$createElement;e._self._c},o=[];a.d(t,"b",function(){return i}),a.d(t,"c",function(){return o}),a.d(t,"a",function(){return n})}},[["a946","common/runtime","common/vendor"]]]);