(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesBackStage/pro_edit/pro_edit"],{"1ab9":function(t,e,i){"use strict";var a=i("49f2"),r=i.n(a);r.a},"3bc3":function(t,e,i){"use strict";(function(t){i("d28f");a(i("66fd"));var e=a(i("ecfb"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("5486")["createPage"])},"49f2":function(t,e,i){},"55ee":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;i("88e4");var a={data:function(){return{$imgurl:this.$imgurl,gid:0,pro_name:"",pro_lanmu:"",showlanmu:0,pro_thumb:"",pro_text:[],pro_freight:"",pro_market:"",pro_price:"",pro_dprice:"",pro_stock:"",pro_vsales:"",pro_sales:0,pro_usejf:"",pro_givejf:"",pro_onejf:"",pro_limitjf:"",ggz_box:0,iseShelf:!1,isVip:!1,isDiscount:!1,isFx:!1,isShare:!1,arr2:["快递","自取","全部"],index2:2,arr3:["固定运费","运费模板"],index3:0,arr4:[],index4:0,yunfei_ggid:0,yunfei_gg_list:[],arr5:["单规格","多规格"],index5:0,gg_box:0,cate_all:[],cate_choose:[],pro_guig:{},pro_guig_count:0,add_gg:"",add_gg_attr:"",show_gg_attr:[],add_edit_gg:0,curr_gg_attr:{},curr_gg_attr_value:[],type_value:[],product_txt:"",editorBox:0,readOnly:!1,formats:{},release_img:"",is_sub:0,w_width:"",w_height:""}},onLoad:function(e){var i=this;e.gid&&(this.gid=e.gid),this.gid?this.getProduct():this.getCateAndYun(),t.getSystemInfo({success:function(t){i.w_width=t.windowWidth,i.w_height=t.windowHeight}}),t.loadFontFace({family:"Pacifico",source:'url("https://sungd.github.io/Pacifico.ttf")'})},onPullDownRefresh:function(){this.gid?this.getProduct():this.getCateAndYun(),t.stopPullDownRefresh()},methods:{getProduct:function(){var e=this;t.request({url:this.$host+"/api/Managewxapp/getDuoProductsInfo",data:{uniacid:this.$uniacid,suid:t.getStorageSync("suid"),gid:e.gid},success:function(i){if(0==i.data.data.error){var a=i.data.data.product;if(e.product_txt=a.product_txt,e.pro_name=a.title,e.pro_lanmu=a.cate_name,e.pro_thumb=a.thumb,e.pro_text=a.text,e.pro_market=a.market_price,e.pro_price=a.price,e.pro_stock=a.pro_kc,e.pro_sales=a.sale_tnum,e.pro_vsales=a.sale_num,e.index5=1==a.use_more?1:0,e.cate_all=a.cate_all,e.cate_choose=a.cates,1==a.use_more){e.pro_guig=a.pro_guig,e.type_value=a.type_value;var r=Object.keys(e.pro_guig);e.doShowDefaultAttr(r),e.pro_guig_count=r.length}e.changeCate(),0==a.is_sale?e.iseShelf=!0:e.iseShelf=!1,e.index2=a.kuaidi,e.index3=a.freight_type,e.pro_freight=a.freight_price,e.arr4=a.yunfei_gg_list_name,e.index4=a.yunfei_ggid_index,e.yunfei_ggid=a.yunfei_ggid,e.yunfei_gg_list=a.yunfei_gg_list,e.pro_usejf=a.score,e.pro_givejf=a.scoreback,a.vipconfig&&(e.isVip=1==a.vipconfig.set1),e.isShare=1==a.get_share_gz,e.pro_onejf=a.get_share_score,e.pro_limitjf=a.get_share_num,e.isFx=1==a.fx_uni,e.product_txt=a.product_txt}else t.showModal({title:"提示",content:i.data.data.msg,showCancel:!1,success:function(e){t.navigateBack({})}})}})},getCateAndYun:function(){var e=this;t.request({url:this.$host+"/api/Managewxapp/getProductCateAndYun",data:{uniacid:this.$uniacid,suid:t.getStorageSync("suid")},success:function(t){e.cate_all=t.data.data.set.listAll,e.yunfei_gg_list=t.data.data.set.yunfei_gg_list,e.arr4=t.data.data.set.yunfei_gg_list_name}})},doShowDefaultAttr:function(t){for(var e=0;e<t.length;e++)this.curr_gg_attr[t[e]]=0;this.doCurrentAttrValue()},doCurrentAttrValue:function(){for(var t=this.curr_gg_attr,e=this.pro_guig,i=Object.keys(this.pro_guig),a=[],r=0;r<i.length;r++)a.push(e[i[r]][t[i[r]]]);for(var s=this.type_value,o=0;o<s.length;o++)1==i.length&&s[o]["type1"]==a[0]&&(this.curr_gg_attr_value=s[o]),2==i.length&&s[o]["type1"]==a[0]&&s[o]["type2"]==a[1]&&(this.curr_gg_attr_value=s[o]),3==i.length&&s[o]["type1"]==a[0]&&s[o]["type2"]==a[1]&&s[o]["type3"]==a[2]&&(this.curr_gg_attr_value=s[o])},changeGuigeVlue:function(t){var e=this.curr_gg_attr,i=t.currentTarget.dataset.index,a=t.currentTarget.dataset.kk;e[i]=a,this.curr_gg_attr=e,this.doCurrentAttrValue()},changeCate:function(){for(var t="",e=0;e<this.cate_all.length;e++)this.cate_choose.indexOf(this.cate_all[e].id)>=0?(t||(t=this.cate_all[e].name),this.cate_all[e].choose=!0):this.cate_all[e].choose=!1;this.cate_choose.length>0&&(this.pro_lanmu=t+"...")},chooseCate:function(t){var e=t.currentTarget.dataset.id,i=t.currentTarget.dataset.isch;if(i){var a=this.cate_choose.indexOf(e);this.cate_choose.splice(a,1)}else this.cate_choose.push(e);this.changeCate()},addGuiGe:function(){return this.add_gg?0==this.show_gg_attr.length?(t.showToast({title:"请至少添加一个属性",duration:1500,icon:"none"}),!1):(this.gg_box=0,void this.doChangeGuiGe()):(t.showToast({title:"请输入规格名称",duration:1500,icon:"none"}),!1)},doChangeGuiGe:function(){var t=this.show_gg_attr,e=this.add_gg;Object.defineProperty(this.pro_guig,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),1==this.add_edit_gg&&(this.pro_guig_count+=1),this.doChangeGuiGeData()},doChangeGuiGeData:function(){var t=Object.values(this.pro_guig),e=(this.type_value,[]),i=Object.keys(this.pro_guig),a=i.join(","),r=i.length;if(1==r)for(var s=0;s<t[0].length;s++){var o=this.checkGuigeData(1,a,t[0][s]);e.push(o)}if(2==r)for(s=0;s<t[0].length;s++)for(var n=0;n<t[1].length;n++){o=this.checkGuigeData(2,a,t[0][s],t[1][n]);e.push(o)}if(3==r)for(s=0;s<t[0].length;s++)for(n=0;n<t[1].length;n++)for(var u=0;u<t[2].length;u++){o=this.checkGuigeData(3,a,t[0][s],t[1][n],t[2][u]);e.push(o)}this.type_value=e,this.doCurrentAttrValue(),this.show_gg_attr=[],this.add_gg=""},checkGuigeData:function(t,e,i){for(var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s="",o=0;o<this.type_value.length;o++)1==t&&i==this.type_value[o]["type1"]&&(s=this.type_value[o],s["comment"]=e),2==t&&i==this.type_value[o]["type1"]&&a==this.type_value[o]["type2"]&&(s=this.type_value[o],s["comment"]=e),3==t&&i==this.type_value[o]["type1"]&&a==this.type_value[o]["type2"]&&r==this.type_value[o]["type3"]&&(s=this.type_value[o],s["comment"]=e);if(!s){var n={id:-1};n.pid=this.gid,n.type1=i,n.type2=a,n.type3=r,n.kc=0,n.price=0,n.hnum="0",n.comment=e,n.thumb="",n.salenum=0,n.vsalenum=0,s=n}return s},del_gg_attr:function(t){var e=t.currentTarget.dataset.key;this.show_gg_attr.splice(e,1)},editGuige:function(t){var e=t.currentTarget.dataset.index;this.gg_box=1,this.add_edit_gg=2,this.show_gg_attr=this.pro_guig[e],this.add_gg=e},addInputGgName:function(t){var e=t.detail.value;this.add_gg=e},input_name:function(t){var e=t.detail.value;this.pro_name=e},input_freight:function(t){var e=t.detail.value;this.pro_freight=e},input_market:function(t){var e=t.detail.value;this.pro_market=e},input_price:function(t){var e=t.detail.value;this.pro_price=e},input_dprice:function(t){var e=t.detail.value,i=this.getCurrTypeIndex();this.type_value[i]["price"]=e},getCurrTypeIndex:function(){for(var t=this.curr_gg_attr,e=this.pro_guig,i=Object.keys(this.pro_guig),a=[],r=0;r<i.length;r++)a.push(e[i[r]][t[i[r]]]);for(var s=this.type_value,o=0;o<s.length;o++){if(1==i.length&&s[o]["type1"]==a[0])return o;if(2==i.length&&s[o]["type1"]==a[0]&&s[o]["type2"]==a[1])return o;if(3==i.length&&s[o]["type1"]==a[0]&&s[o]["type2"]==a[1]&&s[o]["type3"]==a[2])return o}},input_stock:function(t){var e=t.detail.value;if(e<0)return this.errorMsg("库存不能为负数"),!1;this.pro_stock=e},input_dstock:function(t){var e=t.detail.value;if(e<0)return this.errorMsg("库存不能为负数"),!1;var i=this.getCurrTypeIndex();this.type_value[i]["kc"]=e},chooseGuigeThumb:function(){this.chooseImg(4)},input_vsales:function(t){var e=t.detail.value;if(e<0)return this.errorMsg("销量不能为负数"),!1;this.pro_vsales=e},input_usejf:function(t){var e=t.detail.value;this.pro_usejf=e},input_givejf:function(t){var e=t.detail.value;this.pro_givejf=e},input_onejf:function(t){var e=t.detail.value;this.pro_onejf=e},input_limitjf:function(t){var e=t.detail.value;this.pro_limitjf=e},chooseColumn:function(){var t=this;0==t.showlanmu&&(t.showlanmu=1)},closelanmu:function(){var t=this;1==t.showlanmu&&(t.showlanmu=0)},choosePickup:function(t){var e=this;e.index2=t.target.value},chooseFreight:function(t){var e=this;e.index3=t.target.value},chooseMould:function(t){var e=this;e.index4=t.target.value,e.yunfei_ggid=e.yunfei_gg_list[e.index4]["id"]},chooseGuige:function(t){var e=this;e.index5=t.target.value},changeShelf:function(){this.iseShelf=!this.iseShelf},changeBuy:function(){this.isVip=!this.isVip},changeJfShare:function(){this.isShare=!this.isShare},changeDiscount:function(){this.isDiscount=!this.isDiscount},changeFx:function(){this.isFx=!this.isFx},addGgbox:function(){var t=this;0==t.gg_box&&(t.gg_box=1),t.add_edit_gg=1},add_ggz:function(){var t=this;0==t.ggz_box&&(t.ggz_box=1)},getinpggz:function(t){var e=this;e.add_gg_attr=t.detail.value},addSureggz:function(){var e=this;e.add_gg_attr?(1==e.ggz_box&&(e.ggz_box=0,e.show_gg_attr.push(e.add_gg_attr)),e.add_gg_attr=""):t.showModal({title:"提示",content:"请输入规格值",showCancel:!1,success:function(){}})},closeGgbox:function(){var t=this;1==t.gg_box&&(t.gg_box=0),this.show_gg_attr=[],this.add_gg=""},delGgbox:function(){var t=this;1==t.gg_box&&(t.gg_box=0),delete this.pro_guig[this.add_gg],this.pro_guig_count-=1,this.doChangeGuiGeData(),this.show_gg_attr=[],this.add_gg=""},errorMsg:function(e){t.showToast({title:e,duration:1e3,icon:"none"})},getEditor:function(){t.showModal({title:"提示",content:"此端暂不支持富文本编辑，请前往H5端、微信端或后台填写详情！",showCancel:!1,success:function(t){}})},closeEditor:function(){var t=this;t.editorBox=0},readOnlyChange:function(){this.readOnly=!this.readOnly},onEditorReady:function(){var e=this;t.createSelectorQuery().select("#editor").context(function(t){e.editorCtx=t.context,e.editorCtx.setContents({html:e.product_txt})}).exec()},undo:function(){this.editorCtx.undo()},redo:function(){this.editorCtx.redo()},format:function(t){var e=t.target.dataset,i=e.name,a=e.value;i&&this.editorCtx.format(i,a)},onStatusChange:function(t){var e=t.detail;this.formats=e},insertDivider:function(){this.editorCtx.insertDivider({success:function(){console.log("insert divider success")}})},clear:function(){this.editorCtx.clear({success:function(t){console.log("clear success")}})},removeFormat:function(){this.editorCtx.removeFormat()},insertDate:function(){var t=new Date,e="".concat(t.getFullYear(),"/").concat(t.getMonth()+1,"/").concat(t.getDate());this.editorCtx.insertText({text:e})},insertImage:function(){this.chooseImg(1)},chooseThumb:function(){this.chooseImg(2)},chooseThumbs:function(){this.chooseImg(3)},chooseImg:function(e){var i=this,a=i.$baseurl+"wxupimg";t.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(r){t.showLoading({title:"图片上传中"});var s=r.tempFilePaths,o=0,n=(s.length,function(){t.uploadFile({url:a,formData:{uniacid:i.$uniacid},filePath:s[o],name:"file",success:function(a){a.data;if(2==e&&(i.pro_thumb=a.data),3==e&&i.pro_text.push(a.data),1==e&&i.editorCtx.insertImage({src:a.data,alt:"图像",success:function(){console.log("insert image success")}}),4==e){var r=i.getCurrTypeIndex();i.type_value[r]["thumb"]=a.data}t.hideLoading()},fail:function(t){console.log(t)}})});n()}})},delimg:function(t){var e=this,i=t.currentTarget.dataset.index,a=e.pro_text;a.splice(i,1),e.pro_text=a},saveContent:function(){var t=this;this.editorCtx.getContents({success:function(e){t.product_txt=e.html,t.editorBox=0}})},formSubmit:function(e){if(1==this.is_sub)return!1;var i=e.detail.value,a=i.proname,r={};if(!a)return this.errorMsg("商品名称不能为空"),!1;if(r["title"]=a,0==this.cate_choose.length)return this.errorMsg("请选择商品栏目"),!1;if(r["cate_pro"]=this.cate_choose,this.pro_thumb?r["thumb"]=this.pro_thumb:this.errorMsg("商品缩略图"),r["pro_text"]=this.pro_text,r["is_sale"]=this.iseShelf?0:1,r["kuaidi"]=this.index2,r["freight_type"]=this.index3,0==this.index3)r["freight_price"]=this.pro_freight?this.pro_freight:0;else{if(console.log(this.yunfei_ggid),0==this.yunfei_ggid&&1!=this.index2)return this.errorMsg("请选择运费模板"),!1;r["yunfei_ggid"]=this.yunfei_ggid}if(0==this.index5){if(r["use_more"]=2,!this.pro_market)return this.errorMsg("请输入商品市场价"),!1;if(r["market_price"]=this.pro_market,!this.pro_price)return this.errorMsg("请输入商品售价"),!1;r["price"]=this.pro_price,r["sale_num"]=this.pro_vsales,r["pro_kc"]=this.pro_stock}else r["use_more"]=1,r["duo_type_value"]=this.type_value;r["score"]=this.pro_usejf,r["scoreback"]=this.pro_givejf,this.isShare?r["get_share_gz"]=1:r["get_share_gz"]=2,r["get_share_num"]=this.pro_limitjf,r["get_share_score"]=this.pro_onejf,r["fx_uni"]=this.isFx?1:2,r["set1"]=this.isVip?1:0,this.is_sub,this.product_txt||(this.product_txt="请填写商品详情"),t.request({url:this.$host+"/api/Managewxapp/saveDuoProducts",data:{uniacid:this.$uniacid,suid:t.getStorageSync("suid"),gid:this.gid,pro_data:JSON.stringify(r),product_txt:this.product_txt},success:function(e){if(0!=e.data.data.error)return t.showModal({title:"提示",content:e.data.data.msg,showCancel:!1,success:function(t){}}),!1;t.showModal({title:"提示",content:"保存成功",showCancel:!1,success:function(e){e.confirm&&t.reLaunch({url:"/pagesBackStage/pro_manage/pro_manage"})}})}})}}};e.default=a}).call(this,i("5486")["default"])},dfaa:function(t,e,i){"use strict";var a,r=function(){var t=this,e=t.$createElement;t._self._c},s=[];i.d(e,"b",function(){return r}),i.d(e,"c",function(){return s}),i.d(e,"a",function(){return a})},ecfb:function(t,e,i){"use strict";i.r(e);var a=i("dfaa"),r=i("f293");for(var s in r)"default"!==s&&function(t){i.d(e,t,function(){return r[t]})}(s);i("1ab9");var o,n=i("f0c5"),u=Object(n["a"])(r["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],o);e["default"]=u.exports},f293:function(t,e,i){"use strict";i.r(e);var a=i("55ee"),r=i.n(a);for(var s in a)"default"!==s&&function(t){i.d(e,t,function(){return a[t]})}(s);e["default"]=r.a}},[["3bc3","common/runtime","common/vendor"]]]);