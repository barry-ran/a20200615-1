(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesPluginSupply/release/release"],{"45d3":function(e,t,a){"use strict";a.r(t);var n=a("cca0"),i=a.n(n);for(var s in n)"default"!==s&&function(e){a.d(t,e,function(){return n[e]})}(s);t["default"]=i.a},"6ee9":function(e,t,a){"use strict";var n={auth:()=>Promise.all([a.e("common/vendor"),a.e("components/auth/auth")]).then(a.bind(null,"a32a")),bindPhone:()=>Promise.all([a.e("common/vendor"),a.e("components/bindPhone/bindPhone")]).then(a.bind(null,"9bb9"))},i=function(){var e=this,t=e.$createElement;e._self._c},s=[];a.d(t,"b",function(){return i}),a.d(t,"c",function(){return s}),a.d(t,"a",function(){return n})},"6fd0":function(e,t,a){"use strict";var n=a("d89a"),i=a.n(n);i.a},ab08:function(e,t,a){"use strict";a.r(t);var n=a("6ee9"),i=a("45d3");for(var s in i)"default"!==s&&function(e){a.d(t,e,function(){return i[e]})}(s);a("6fd0");var o,c=a("f0c5"),u=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],o);t["default"]=u.exports},cca0:function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a("88e4"),i={data:function(){return{$imgurl:this.$imgurl,release_money:0,stick_money:0,stick_days:7,release_img:[],cons:"",type:1,rid:0,funcAll:[{}],funcTitleArr:["供应","求购"],index:0,userMoney:0,success_rid:0,address:"",tel:"",stick:2,update:0,cons_len:0,baseinfo:"",needAuth:!1,needBind:!1,orderid:"",pay_type:1,show_pay_type:0,alipay:1,wxpay:1,money:0,title:"",isiPhone:0}},onLoad:function(t){var a=this,i=t.id;this.id=i,this._baseMin(this),2==t.type&&(this.index=1,this.type=1);var s=e.getStorageSync("systemInfo");"ios"==s.platform&&this.isiPhone;var o=0;t.fxsid&&(o=t.fxsid),this.fxsid=o;var c=t.fid;c>0&&(this.fid=c);var u=t.rid;u>0&&(this.rid=u);var d=e.getStorageSync("suid");if(d)n.bdLogin(o,function(){a.getRelease(i)});else{this.getRelease(i);var r=e.getStorageSync("baidu_userinfo");r?this.needBind=!0:this.needAuth=!0}},methods:{getRelease:function(){var t=this;1==t.baseinfo.can_fs&&e.setNavigationBarTitle({title:"发布信息"}),t.getforumset(),t.rid>0&&t.getReleaseInfo()},getInputTel:function(e){var t=e.detail.value;this.telphone=t},getInputTitle:function(e){var t=e.detail.value;this.title=t},getReleaseInfo:function(){var t=this;e.request({url:t.$baseurl+"doPageGetSupplyCon",data:{rid:t.rid,uniacid:t.$uniacid,types:1},success:function(e){t.cons=e.data.data.content,t.release_img=e.data.data.img,t.release_money=0,t.fid=e.data.data.fid,t.type=e.data.data.fid,t.telphone=e.data.data.telphone,t.address=e.data.data.address,t.stick=e.data.data.stick,t.update=1,t.title=e.data.data.title,t.cons_len=t.cons.length}})},getlocation:function(){var t=this;e.chooseLocation({success:function(e){console.log(e),t.address=e.name},fail:function(){e.getSetting({success:function(a){var n=a.authSetting;n["scope.userLocation"]||e.showModal({title:"请授权获取当前位置",content:"获取位置需要授权此功能",showCancel:!1,success:function(a){a.confirm&&e.openSetting({success:function(a){!0===a.authSetting["scope.userLocation"]?e.showToast({title:"授权成功",icon:"success",duration:1e3}):e.showToast({title:"授权失败",icon:"success",duration:1e3,success:function(){t.getlocation()}})}})}})},fail:function(t){e.showToast({title:"调用授权窗口失败",icon:"success",duration:1e3})}})}})},bindPickerChange:function(e){console.log(e);var t=this,a=e.detail.value;t.funcAll;t.index=a,t.type=1*a+1,console.log(t.type)},releasePay:function(t){var a=this;if(!this.getSuid())return!1;if(""==a.title)return e.showModal({title:"提示",showCancel:!1,content:"标题不能为空"}),!1;if(a.title.length>10)return e.showModal({title:"提示",showCancel:!1,content:"标题不能超过10个字符"}),!1;var n=a.cons;if(""==n)return e.showModal({title:"提示",showCancel:!1,content:"发布信息不能为空"}),!1;if(!/^1[3456789]\d{9}$/.test(a.telphone))return e.showModal({title:"提示",showCancel:!1,content:"手机格式不正确"}),!1;var i=t.detail.formId;a.formId=i,a.releasePays()},checkcontents:function(){var t=this;e.request({url:t.$baseurl+"doPageCheckContents",data:{uniacid:t.$uniacid,content:t.title+t.cons,source:e.getStorageSync("source")},success:function(a){return 1==a.data.data?(e.showModal({title:"提示",content:"小程序相关信息错误，无法发布",showCancel:!1}),!1):2==a.data.data?(e.showModal({title:"提示",content:"提交内容涉嫌违法违规，请修改后再提交",showCancel:!1}),!1):void(0==a.data.data&&t.releasePays())}})},releasePays:function(){var t=this,a=t.formId,n=t.release_money,i=t.userMoney,s=t.update;n>0&&0==s?e.request({url:t.$baseurl+"doPageSupplyOrder",data:{uniacid:t.$uniacid,release_money:n,suid:e.getStorageSync("suid"),formId:a},success:function(a){0!=a.data&&(t.orderid=a.data.orderid,i>=n?e.showModal({title:"请注意",content:"您的余额为"+i+"元，本次将扣除"+n+"元",success:function(a){a.confirm&&e.request({url:t.$baseurl+"doPageSupplyChangemymoney",data:{uniacid:t.$uniacid,orderid:t.orderid,release_money:n,suid:e.getStorageSync("suid")},success:function(e){if(1!=e.data.data)return!1;t.releaseSub(1)}})}}):(t.releaseSub(2),i>0?e.showModal({title:"请注意",content:"您将余额支付"+i+"元，百度支付"+(n-i)+"元",success:function(e){e.confirm&&t._baidupay(t,n-i,"supfabu",t.orderid,1)}}):e.showModal({title:"请注意",content:"您将百度支付"+n+"元",success:function(e){e.confirm&&t._baidupay(t,n,"supfabu",t.orderid,1)}})))},fail:function(e){}}):t.releaseSub(1)},releaseSub:function(t){var a=this,n=a.cons,i=a.release_money,s=a.release_img;0==s.length&&(s=""),e.request({url:a.$baseurl+"doPageSupplyReleaseSub",data:{uniacid:a.$uniacid,fid:a.type,rid:a.rid,cons:n,release_money:i,title:a.title,release_img:JSON.stringify(s),address:a.address,telphone:a.telphone,suid:e.getStorageSync("suid"),source:e.getStorageSync("source"),haspay:t,orderid:a.orderid},success:function(t){var n=t.data.data;n>0?e.showModal({title:"提示",showCancel:!1,content:"发布成功",success:function(){e.navigateBack({delta:1});var t=a.stick;if(1==t){a.fid;e.navigateBack({delta:1})}else a.success_rid=n}}):0==n&&e.showToast({title:"发布失败"})},fail:function(e){}})},goReleaseLists:function(){var t=this;t.fid;e.navigateBack({delta:1})},go_set_top:function(){var t=this,a=t.fid,n=t.success_rid;e.redirectTo({url:"/pagesPluginSupply/set_top/set_top?fid="+a+"&rid="+n+"&returnpage=2"})},delimg:function(e){console.log(e);var t=this,a=e.currentTarget.dataset.index,n=t.release_img;n.splice(a,1),t.release_img=n},getforumset:function(){var t=this;e.request({url:t.$baseurl+"doPageSupplySet",data:{uniacid:t.$uniacid,suid:e.getStorageSync("suid")},success:function(e){t.release_money=e.data.data.release_money,t.stick_money=e.data.data.stick_money,t.userMoney=e.data.data.mymoney},fail:function(e){console.log(e)}})},getcons:function(e){var t=this,a=e.detail.value,n=a.length;t.cons=a,t.cons_len=n},chooseImg:function(){var t=this,a=t.zhixin,n=t.release_img;n||(n=[]);var i=t.$baseurl+"wxupimg";e.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(s){console.log(s),a=!0,t.zhixin=a,e.showLoading({title:"图片上传中"});var o=s.tempFilePaths,c=0,u=o.length,d=function s(){e.uploadFile({url:i,formData:{uniacid:t.$uniacid},filePath:o[c],name:"file",success:function(i){var o=i.data;n.push(o),t.release_img=n,c++,c<u?s():(a=!1,t.zhixin=a,e.hideLoading())},fail:function(e){console.log(e)}})};d(),console.log(t.release_img)}})},select:function(){var e=this,t=e.select;t=2==t?1:2,e.select=t},bindManual:function(e){var t=e.detail.value;this.stick_days=t},cell:function(){this.needAuth=!1},closeAuth:function(){this.needAuth=!1,this.needBind=!0},closeBind:function(){this.needBind=!1,this.getRelease()},getSuid:function(){var t=e.getStorageSync("suid");if(t)return!0;var a="";return a=e.getStorageSync("baidu_userinfo"),a?this.needBind=!0:this.needAuth=!0,!1},showpay:function(){this.money=this.release_money-this.userMoney;var t=this;e.request({url:this.$baseurl+"doPageGetH5payshow",data:{uniacid:this.$uniacid,suid:e.getStorageSync("suid")},success:function(a){0==a.data.data.ali&&0==a.data.data.wx?e.showModal({title:"提示",content:"请联系管理员设置支付参数",showCancel:!1,success:function(e){return!1}}):(0==a.data.data.ali?(t.alipay=0,t.pay_type=2):(t.alipay=1,t.pay_type=1),0==a.data.data.wx?t.wxpay=0:t.wxpay=1,t.show_pay_type=1)}})},changealipay:function(){this.pay_type=1},changewxpay:function(){this.pay_type=2},close_pay_type:function(){this.show_pay_type=0},h5topay:function(){var e=this.pay_type;1==e?this._alih5pay(this,this.release_money-this.userMoney,5,this.orderid):2==e&&this._wxh5pay(this,this.release_money-this.userMoney,"supfabu",this.orderid),this.show_pay_type=0}}};t.default=i}).call(this,a("5486")["default"])},d081:function(e,t,a){"use strict";(function(e){a("d28f");n(a("66fd"));var t=n(a("ab08"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("5486")["createPage"])},d89a:function(e,t,a){}},[["d081","common/runtime","common/vendor"]]]);