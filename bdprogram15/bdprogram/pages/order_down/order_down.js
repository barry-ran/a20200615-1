(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order_down/order_down"],{1832:function(t,a,e){"use strict";var i={datetime:()=>e.e("components/datetime/datetime").then(e.bind(null,"c598"))},o=function(){var t=this,a=t.$createElement;t._self._c},s=[];e.d(a,"b",function(){return o}),e.d(a,"c",function(){return s}),e.d(a,"a",function(){return i})},3713:function(t,a,e){"use strict";var i=e("a4ce"),o=e.n(i);o.a},"3fac":function(t,a,e){"use strict";e.r(a);var i=e("1832"),o=e("48e5");for(var s in o)"default"!==s&&function(t){e.d(a,t,function(){return o[t]})}(s);e("3713");var n,r=e("f0c5"),d=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],n);a["default"]=d.exports},"48e5":function(t,a,e){"use strict";e.r(a);var i=e("aa77"),o=e.n(i);for(var s in i)"default"!==s&&function(t){e.d(a,t,function(){return i[t]})}(s);a["default"]=o.a},a4ce:function(t,a,e){},aa77:function(t,a,e){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;e("2f62");var i=function(){return e.e("components/datetime/datetime").then(e.bind(null,"c598"))},o=e("88e4"),s={data:function(){return{$imgurl:this.$imgurl,$host:this.$host,baseinfo:"",currentTab:0,showCouponBox:0,baoyou:-1,default_address:"",add_id:0,default_concat:"",self_taking_time:"",shop_info:"",shop_id:0,take_self:0,buyPro:[],total_num:0,total_price:0,from_gwc:0,nav:1,coupon_index:"",coupon_id:0,coupon_use:0,coupon_list:[],mymoney:0,gzscore:0,score_use:0,score_money:0,pay_money:"",discount_money:0,total_discount_price:0,user_remark:"",formlist_id:0,formlist_val:"",suid:"",buydata:"",freight_money:0,error_msg:"",error_msg_plus:"",start_year:2019,end_year:2060,source:"",free_package:0,openid:"",showPay:0,choosepayf:0,mymoney_pay:1,pay_type:1,is_submit:1,use_score:0,h5_wxpay:0,h5_alipay:0,forminfo:"",forminfolist:"",error_num:0,ps_name:"快递配送",zq_name:"到店自取",lack_money:0}},components:{datetime:i},onLoad:function(a){var e=this,i="";i=t.getStorageSync("openid"),this.openid=i;var s=t.getStorageSync("buydata");s&&(this.buydata=JSON.stringify(s));var n=t.getStorageSync("suid");n&&(this.suid=n);var r=t.getStorageSync("source");this.source=r;var d=a.from_gwc;d&&(this.from_gwc=d);var c=a.currentTab;c&&(this.currentTab=c);var u=a.nav;u&&(this.nav=u);var h=a.add_id;h&&(this.add_id=h);var l=a.shop_id;l&&(this.shop_id=l),this._baseMin(this);var f=0;a.fxsid&&(f=a.fxsid),this.fxsid=f,o.bdLogin(f,function(){e.myContactInfo(),e.getFormInfo()})},methods:{chooseStore:function(){t.navigateTo({url:"/pages/chooseStore/chooseStore?from_gwc="+this.from_gwc+"&nav="+this.nav+"&address_id="+this.add_id+"&stid="+this.shop_id+"&type=mainShop"})},paybox:function(){var a=this.currentTab;if(1==a){var e=this.shop_id;if(!e)return t.showModal({title:"提示",content:"请先选择门店",showCancel:!1}),!1;var i=this.self_taking_time;if(!i)return t.showModal({title:"提示",content:"请先选择预约取件时间",showCancel:!1}),!1;var o=this.default_concat;if(!o)return t.showModal({title:"提示",content:"请先输入预留电话",showCancel:!1}),!1;var s=/^1[3456789]{1}\d{9}$/;if(!s.test(o))return t.showModal({title:"提醒",content:"请您输入正确的手机号码",showCancel:!1}),!1}else{var n=this.add_id;if(!n)return t.showModal({title:"提示",content:"请先选择收件地址",showCancel:!1}),!1}for(var r=this.forminfolist,d=0;d<r.length;d++)if(1==r[d].ismust)if(5==r[d].type){if(""==r[d].z_val)return t.showModal({title:"提醒",content:r[d].name+"为必填项！",showCancel:!1}),!1}else{if(""==r[d].val)return t.showModal({title:"提醒",content:r[d].name+"为必填项！",showCancel:!1}),!1;if(0==r[d].type&&1==r[d]["tp_text"][0]["yval"]){var c=/^1[3456789]{1}\d{9}$/;if(!c.test(r[d].val))return t.showModal({title:"提醒",content:"请您输入正确的手机号码",showCancel:!1}),!1}else if(0==r[d].type&&7==r[d]["tp_text"][0]["yval"]){var u=/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/;if(!u.test(r[d].val))return t.showModal({title:"提醒",content:"请您输入正确的身份证号",showCancel:!1}),!1}}var h=this.mymoney,l=this.pay_money;l>h&&(this.mymoney_pay=2,this.pay_type=2,this.choosepayf=4),0==this.showPay&&(this.showPay=1)},payboxclose:function(){1==this.showPay&&(this.showPay=0)},choosepay:function(t){this.pay_type=t.currentTarget.dataset.pay_type,this.choosepayf=t.currentTarget.dataset.type},openDatetimePicker:function(t){this.$refs.myPicker.show()},closeDatetimePicker:function(){this.$refs.myPicker.hide()},handleSubmit:function(t){this.self_taking_time="".concat(t.year,"-").concat(t.month,"-").concat(t.day," ").concat(t.hour,":").concat(t.minute)},getCouponBox:function(){var t=this;t.showCouponBox=1},closeCouponBox:function(){this.showCouponBox=0},changeCoupon:function(a){this.total_price;var e=this.coupon_id,i=this.coupon_index,o=this.coupon_list,s=this.coupon_use,n=a.currentTarget.dataset.index;o[n]["can_use"]?(e>0?i==n?(o[n]["is_check"]=0,e=0,i=0,s=0):(o[i]["is_check"]=0,o[n]["is_check"]=1,e=o[n]["id"],i=n,s=o[n]["price"]):(o[n]["is_check"]=1,e=o[n]["id"],i=n,s=o[n]["price"]),this.coupon_list=o,this.coupon_id=e,this.coupon_index=i,this.coupon_use=s,this.getpay(1),this.showCouponBox=0):t.showModal({title:"提示",content:o[n]["can_use_msg"]+"，不可使用",showCancel:!1})},getMyCoupon:function(){var a=this;t.request({url:this.$host+"/api/MainWxapp/doPageGetMyCoupon",data:{uniacid:this.$uniacid,suid:this.suid,buydata:this.buydata,total_price:this.total_price},success:function(t){a.coupon_list=t.data.data.coupon_list,a.mymoney=t.data.data.userinfo.money}})},toCatelist:function(){t.navigateTo({url:"/pages/catelist/catelist"})},getFormInfo:function(){var a=this;t.request({url:this.$host+"/api/MainWxapp/getFormInfo",data:{uniacid:this.$uniacid},success:function(t){a.forminfo=t.data.data,a.forminfo&&(a.formlist_id=t.data.data.id,a.formdescs=t.data.data.descs,a.forminfolist=t.data.data.tp_text)}})},myContactInfo:function(){var a=this;t.request({url:a.$host+"/api/MainWxapp/getMyContactInfo",data:{uniacid:a.$uniacid,suid:a.suid,add_id:a.add_id,shop_id:a.shop_id},success:function(t){a.baoyou=t.data.data.baoyou,a.default_address=t.data.data.default_address,a.default_address&&(a.add_id=a.default_address.id,a.getFreight()),t.data.data.default_concat&&(a.default_concat=t.data.data.default_concat.mobile),a.shop_info=t.data.data.shop_info,a.take_self=t.data.data.take_self,t.data.data.ps_name&&(a.ps_name=t.data.data.ps_name),t.data.data.zq_name&&(a.zq_name=t.data.data.zq_name),a.getBuyGoodsInfo()}})},getBuyGoodsInfo:function(){var a=this;t.request({url:this.$host+"/api/MainWxapp/getBuyGoodsInfo",data:{uniacid:this.$uniacid,suid:this.suid,buydata:this.buydata},success:function(e){var i=e.data.data.error;if(0==i){var o=e.data.data.buyPro;if(0==a.from_gwc){var s=1*o[0]["kuaidi"]+1;2==s&&(a.currentTab=1),a.nav=s}else 2==a.nav&&(a.currentTab=1);a.buyPro=o,a.total_num=e.data.data.total_num,a.total_price=e.data.data.total_price,a.lack_money=(1*a.baoyou-1*a.total_price).toFixed(2),a.total_discount_price=e.data.data.total_discount_price,e.data.data.total_price>0&&(a.getMyCoupon(),a.getpay())}else t.showModal({title:"提示",content:e.data.data.msg,showCancel:!1,success:function(a){t.navigateBack({delta:1})}})}})},concat_input:function(t){this.default_concat=t.detail.value},clickTab:function(t){var a=this;if(a.currentTab==t.currentTarget.dataset.current)return!1;a.currentTab=t.currentTarget.dataset.current,1==a.currentTab?(a.error_msg_plus="",a.getpay()):(a.error_msg_plus=a.error_msg,a.getFreight())},add_address:function(){t.navigateTo({url:"/pages/address/address?shareid="+this.shareid+"&add_id="+this.add_id+"&shop_id="+this.shop_id+"&from_gwc="+this.from_gwc+"&nav="+this.nav})},useScore:function(){var a=this,e=this;0==e.use_score?(e.use_score=1,t.request({url:e.$host+"/api/mainwxapp/dopageptsetgwcscore",data:{uniacid:e.$uniacid,suid:e.suid,buydata:e.buydata},success:function(t){a.score_use=t.data.data.jf,a.score_money=t.data.data.moneycl,a.gzscore=t.data.data.gzscore,a.score_money>0&&a.getpay(2),a.use_score=1}})):(e.use_score=0,this.score_money=0,this.score_use=0,this.gzscore=0,this.getpay())},getFreight:function(){var a=this,e=this.default_address,i=e.address.split(" "),o=i[0]+" "+i[1],s=this.buydata;t.request({url:this.$host+"/api/mainwxapp/doPageGetFreight",data:{uniacid:this.$uniacid,pro_city:o,buydata:s,suid:this.suid},success:function(t){var e=t.data.data.error;a.error_num=t.data.data.error,-1==e?(a.freight_money=0,a.free_package=1):0==e?(a.freight_money=t.data.data.all_freight_price,a.freight_money>0&&a.getpay()):2==e&&0==a.currentTab&&(a.error_msg=t.data.data.error_msg,a.error_msg_plus=t.data.data.error_msg)}})},remarkInput:function(t){var a=t.detail.value;this.user_remark=a},getpay:function(t){var a=this.total_price,e=this.coupon_use,i=this.freight_money,o=this.baoyou,s=this.currentTab;1==s?(i=0,this.freight_money=0,this.free_package=0):a>=o&&o>=0&&(this.free_package=2,this.freight_money=0,i=0);var n=this.score_money,r=0;a-e-n<0?(1==t?this.coupon_use=a-n:(n=Math.ceil(a-e),n>0?(this.score_use=parseInt(this.gzscore*n),this.score_money=n):(this.score_use=0,this.score_money=0)),r=i):(r=a-e-n+1*i,r=r<0?0:r.toFixed(2)),this.pay_money=r},pay:function(a){var e=this,i=this.is_submit;if(2==i)return!1;this.is_submit=2,t.showToast({title:"下单中",icon:"loading",mask:!0});var o=a.detail.formId,s=this.$uniacid,n=this.suid,r=this.source,d=this.buydata,c=1*this.currentTab+1,u=this.pay_type,h=this.pay_money,l=(this.coupon_use+this.score_money).toFixed(2),f=this.freight_money,_=this.total_num,p=this.score_use,m=this.score_money,y=this.coupon_id,g=this.coupon_use,v=this.from_gwc,b=this.user_remark,w=this.formlist_id,x=this.forminfolist,k=this.add_id,T=this.shop_id,C=this.self_taking_time,$=this.default_concat;t.request({url:this.$host+"/api/mainwxapp/createMainGoodsOrder",data:{form_id:o,uniacid:s,suid:n,source:r,buydata:d,delivery_type:c,pay_type:u,pay_money:h,discount_money:l,freight_money:f,total_num:_,score_use:p,score_money:m,coupon_id:y,coupon_use:g,from_gwc:v,user_remark:b,formlist_id:w,address_id:k,self_taking_shop_id:T,self_taking_contact:$,self_taking_time:C,formlist_val:""==x?x:JSON.stringify(x)},success:function(a){var i=a.data.data.order_id,o=a.data.data.error;o?t.showModal({title:"提示",content:a.data.data.msg,showCancel:!1}):1==u?t.request({url:e.$baseurl+"payCallBackNotify",data:{uniacid:e.$uniacid,order_id:i,suid:n,payprice:h,types:"mainShop",flag:0,fxsid:e.fxsid,source:r,pay_to:0},success:function(a){0!=a.data.data.error?t.showToast({title:a.data.data.msg,icon:"none",mask:!0,success:function(){setTimeout(function(){t.redirectTo({url:"/pages/main_shop_order/main_shop_order"})},1e3)}}):t.showToast({title:"购买成功！",icon:"success",mask:!0,success:function(){setTimeout(function(){t.redirectTo({url:"/pages/main_shop_order/main_shop_order"})},1e3)}})}}):e._baidupay(e,h,"mainShop",i,"/pages/main_shop_order/main_shop_order")}})},weixinadd:function(){var a=this;t.chooseAddress({success:function(t){for(var e=t.provinceName+" "+t.cityName+" "+t.countyName+" "+t.detailInfo,i=t.userName,o=t.telNumber,s=a.forminfolist,n=0;n<s.length;n++)0==s[n].type&&2==s[n].tp_text[0].yval&&(s[n].val=i),0==s[n].type&&3==s[n].tp_text[0].yval&&(s[n].val=o),0==s[n].type&&4==s[n].tp_text[0].yval&&(s[n].val=e);a.myname=i,a.mymobile=o,a.myaddress=e,a.forminfolist=s},fail:function(a){t.getSetting({success:function(a){a.authSetting["scope.address"]||t.openSetting({success:function(t){}})}})}})},getPhoneNumber:function(a){var e=this,i=a.detail.iv,o=a.detail.encryptedData;"getPhoneNumber:ok"==a.detail.errMsg?t.checkSession({success:function(){t.request({url:e.$baseurl+"doPagejiemiNew",data:{uniacid:e.$uniacid,newSessionKey:e.newSessionKey,iv:i,encryptedData:o},success:function(a){if(a.data.data){for(var i=e.forminfolist,o=0;o<i.length;o++)0==i[o].type&&5==i[o].tp_text[0].yval&&(i[o].val=a.data.data);e.phoneNumber=a.data.data,e.wxmobile=a.data.data,e.forminfolist=i}else t.showModal({title:"提示",content:"sessionKey已过期，请下拉刷新！"})},fail:function(t){}})},fail:function(){t.showModal({title:"提示",content:"sessionKey已过期，请下拉刷新！"})}}):t.showModal({title:"提示",content:"请先授权获取您的手机号！",showCancel:!1})},bindInputChange:function(t){var a=this,e=t.detail.value,i=t.currentTarget.dataset.index,o=a.forminfolist;o[i].val=e,a.forminfolist=o},bindPickerChange:function(t){var a=this,e=t.detail.value,i=t.currentTarget.dataset.index,o=a.forminfolist,s=o[i].tp_text,n=s[e];o[i].val=n,a.forminfolist=o},bindDateChange:function(t){var a=this,e=t.detail.value,i=t.currentTarget.dataset.index,o=a.forminfolist;o[i].val=e,a.forminfolist=o},bindTimeChange:function(t){var a=this,e=t.detail.value,i=t.currentTarget.dataset.index,o=a.forminfolist;o[i].val=e,a.forminfolist=o},checkboxChange:function(t){var a=this,e=t.detail.value,i=t.currentTarget.dataset.index,o=a.forminfolist;o[i].val=e,a.forminfolist=o},radioChange:function(t){var a=this,e=t.detail.value,i=t.currentTarget.dataset.index,o=a.forminfolist;o[i].val=e,a.forminfolist=o},choiceimg1111:function(a){var e=this,i=0,o=e.zhixin,s=a.currentTarget.dataset.index,n=e.forminfolist,r=n[s].val,d=n[s].tp_text[0];r?i=r.length:(i=0,r=[]);var c=d-i;n[s].z_val&&n[s].z_val;t.chooseImage({count:c,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(a){o=!0,e.zhixin=o,t.showLoading({title:"图片上传中"});var i=a.tempFilePaths,r=0,d=i.length,c=function a(){t.uploadFile({url:e.$baseurl+"wxupimg",formData:{uniacid:e.$uniacid},filePath:i[r],name:"file",success:function(i){n[s].z_val.push(i.data),e.forminfolist=n,r++,r<d?a():(o=!1,e.zhixin=o,t.hideLoading())}})};c()}})},delimg:function(t){var a=this,e=t.currentTarget.dataset.index,i=t.currentTarget.dataset.id,o=a.forminfolist,s=o[e].z_val;s.splice(i,1);var n=s.length;0==n&&(s=""),o[e].z_val=s,a.forminfolist=o}}};a.default=s}).call(this,e("5486")["default"])},b1ad:function(t,a,e){"use strict";(function(t){e("d28f");i(e("66fd"));var a=i(e("3fac"));function i(t){return t&&t.__esModule?t:{default:t}}t(a.default)}).call(this,e("5486")["createPage"])}},[["b1ad","common/runtime","common/vendor"]]]);