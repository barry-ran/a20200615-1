(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shoppay/shoppay"],{4383:function(e,t,n){"use strict";(function(e){n("d28f");a(n("66fd"));var t=a(n("f700"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("5486")["createPage"])},5699:function(e,t,n){"use strict";n.r(t);var a=n("66d0"),i=n.n(a);for(var o in a)"default"!==o&&function(e){n.d(t,e,function(){return a[e]})}(o);t["default"]=i.a},"5ab0":function(e,t,n){},"66d0":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n("88e4"),i={data:function(){return{$imgurl:this.$imgurl,page_signs:"/pages/shoppay/shoppay",baseinfo:[],scopes:!1,money:0,yue:0,guiz:[],weixpay:0,paymoney:0,jifen_u:0,jfscore:0,jfmoney:0,jqdjg:"请选择",yhq_hidden:0,yhqmoney:0,yhq_id:0,sid:0,heights:0,yhq_i:0,showModalStatus:!1,animationData:"",yhq:[],score:0,shopsbase:[],yhqid:0,needAuth:!1,needBind:!1,pay_type:1,show_pay_type:0,alipay:1,wxpay:1,zf_money:0,ischecked:!1}},onPullDownRefresh:function(){var t=this;t.getinfos(),e.stopPullDownRefresh()},onLoad:function(t){var n=this;e.setNavigationBarTitle({title:"快速支付"});var i=this,o=0;t.fxsid&&(this.fxsid=t.fxsid);t.sid&&(this.sid=t.sid),i.sid>0&&i.getshopsbase(),e.getSystemInfo({success:function(e){n.heights=e.windowHeight}});var s=e.getStorageSync("suid");if(this._baseMin(this),s)a.bdLogin(o,function(){i.getGuiz()});else{var r=e.getStorageSync("baidu_userinfo");r?this.needBind=!0:this.needAuth=!0}},methods:{cell:function(){this.needAuth=!1},closeAuth:function(){this.needAuth=!1,this.needBind=!0},closeBind:function(){this.needBind=!1,that.getshopsbase()},getSuid:function(){var t=e.getStorageSync("suid");if(t)return!0;var n="";return n=e.getStorageSync("baidu_userinfo"),n?this.needBind=!0:this.needAuth=!0,!1},redirectto:function(e){var t=e.currentTarget.dataset.link,n=e.currentTarget.dataset.linktype;this._redirectto(t,n)},getGuiz:function(){var t=this,n=e.getStorageSync("suid");e.request({url:t.$baseurl+"doPageGuiz",data:{suid:n,uniacid:t.$uniacid},success:function(e){t.scoreconf=e.data.data.conf,t.yhq=e.data.data.coupon,t.guiz=e.data.data.user,t.yue=e.data.data.user.money,t.score=e.data.data.user.score,t.score_shoppay=e.data.data.conf.score_shoppay},fail:function(e){}})},makePhoneCall:function(t){var n=this,a=n.baseinfo.tel;e.makePhoneCall({phoneNumber:a})},makePhoneCallB:function(t){var n=this,a=n.baseinfo.tel_b;e.makePhoneCall({phoneNumber:a})},chongz:function(){e.redirectTo({url:"/pages/recharge/recharge"})},switchChange:function(e){var t=this,n=!t.ischecked,a=t.paymoney,i=t.yhqmoney,o=(1e3*a-1e3*i)/1e3;if(1==n){t.money;var s=t.weixpay,r=t.yue,c=t.score_shoppay,d=t.score,u=t.scoreconf;if(parseInt(c)>=parseInt(u["score"])&&parseInt(d)>=parseInt(u["score"])){var h=0;if(parseInt(d)>=parseInt(c)?u["score"]>0&&(h=parseInt(c*u["money"]/u["score"]*1)):u["score"]>0&&(h=parseInt(d*u["money"]/u["score"]*1)),h>=o)t.weixpay=0,t.money=0,t.jfmoney=o.toFixed(2),t.jfscore=o*u["score"],t.jifen_u=1;else{var y=0;u["score"]>0&&(y=h*(u["score"]/u["money"]));s=(1e3*o-1e3*r-1e3*h)/1e3;s=s<0?0:s,t.money=((1e3*o-1e3*s-1e3*h)/1e3).toFixed(2),t.weixpay=s.toFixed(2),t.jfmoney=h.toFixed(2),t.jfscore=y,t.jifen_u=1}}else{s=(1e3*o-1e3*r)/1e3;s=s<0?0:s,t.money=((1e3*o-1e3*s)/1e3).toFixed(2),t.weixpay=s.toFixed(2),t.jfmoney=0,t.jfscore=0,t.jifen_u=1}t.ischecked=!0}else{r=t.yue,s=(1e3*o-1e3*r)/1e3;s=s<0?0:s,t.money=((1e3*o-1e3*s)/1e3).toFixed(2),t.weixpay=s.toFixed(2),t.jfscore=0,t.jfmoney=0,t.jifen_u=0,t.ischecked=!1}},setsubmit:function(){if(!this.getSuid())return!1;var t=this,n=e.getStorageSync("openid"),a=t.paymoney,i=t.weixpay,o=t.money,s=t.jfscore,r=(t.yhqmoney,t.yhq_id),c=t.jfmoney;if(!a&&0==c||a<=0&&0==c)return e.showModal({title:"提醒",content:"请输入正确的消费金额！",showCancel:!1}),!1;0==i?e.showModal({title:"提示",content:"确认支付,费用将从余额直接扣除!",cancelText:"取消支付",confirmText:"确认支付",success:function(i){if(i.cancel)return!1;e.request({url:t.$baseurl+"doPageShoppay_duo",data:{uniacid:t.$uniacid,openid:n,suid:e.getStorageSync("suid"),ordermoeny:a,yuemoney:o,money:0,order_id:"",jfscore:s,yhq_id:r,sid:t.sid},header:{"content-type":"application/json"},success:function(n){e.showToast({title:"支付成功",icon:"success",duration:3e3,success:function(){setTimeout(function(){e.redirectTo({url:"/pages/shoppay/shoppay?sid="+t.sid})},3e3)}})}})}}):e.request({url:t.$baseurl+"doPageBalance",data:{uniacid:t.$uniacid,openid:n,yuemoney:o,money:i,yhq_id:r,jfscore:s,source:e.getStorageSync("source"),suid:e.getStorageSync("suid"),sid:t.sid},header:{"content-type":"application/json"},success:function(n){var a=n.data.data.order_id;"success"==n.data.message&&t._baidupay(t,i,"shoppay",a,"/pages/shoppay/shoppay?sid="+t.sid),"error"==n.data.message&&e.showModal({title:"提醒",content:n.data.data.message,showCancel:!1})}})},showpay:function(){var t=this;e.request({url:this.$baseurl+"doPageGetH5payshow",data:{uniacid:this.$uniacid,suid:e.getStorageSync("suid")},success:function(n){0==n.data.data.ali&&0==n.data.data.wx?e.showModal({title:"提示",content:"请联系管理员设置支付参数",success:function(t){e.redirectTo({url:"/pages/index/index"})}}):(0==n.data.data.ali?(t.alipay=0,t.pay_type=2):(t.alipay=1,t.pay_type=1),0==n.data.data.wx?t.wxpay=0:t.wxpay=1,t.show_pay_type=1)}})},changealipay:function(){this.pay_type=1},changewxpay:function(){this.pay_type=2},close_pay_type:function(){this.show_pay_type=0},h5topay:function(){var e=this.pay_type;1==e?this._alih5pay(this,this.zf_money,13,this.orderid):2==e&&this._wxh5pay(this,this.zf_money,"shoppay",this.orderid),this.show_pay_type=0},setmoney:function(e){var t=this,n=e.detail.value,a=e.detail.value;if(t.jfmoney=0,t.jfscore=0,t.jifen_u=0,t.yhq_id=0,t.yhqmoney=0,t.yhqid=0,t.jqdjg="请选择",t.ischecked=!1,""==n||n<=0)return t.money=0,t.weixpay=0,t.paymoney=0,!1;var i=t.yue,o=(1e3*n-1e3*i)/1e3;o=o<0?0:o,t.weixpay=o,t.money=(1e3*n-1e3*o)/1e3,t.paymoney=a},getmoney:function(t){var n=this,a=n.paymoney,i=n.jfmoney,o=n.yhq,s=t.currentTarget.dataset.index,r=(o[s]["price"],o[s]["pay_money"]),c=o[s]["id"],d=(1e3*a-1e3*i)/1e3;if(d<r)return e.showModal({title:"提示",content:"需支付金额未满"+r+"元，不可使用该优惠券！",showCancel:!1}),!1;var u=o[s]["price"],h=n.yue,y=(1e3*d-1e3*h-1e3*u)/1e3;y=y<0?0:y,n.hideModal(),n.money=((1e3*d-1e3*y-1e3*u)/1e3).toFixed(2)<0?0:((1e3*d-1e3*y-1e3*u)/1e3).toFixed(2),n.weixpay=y.toFixed(2),n.yhq_id=c,n.yhqmoney=u,n.jqdjg=o[s]["title"]},qxyh:function(){var e=this,t=e.paymoney,n=e.jfmoney,a=(1e3*t-1e3*n)/1e3,i=e.yue,o=(1e3*a-1e3*i)/1e3;o=o<0?0:o,e.hideModal(),e.money=(1e3*a-1e3*o)/1e3,e.weixpay=o,e.yhq_id=0,e.yhqmoney=0,e.jqdjg="请选择"},showModal:function(){var t=this,n=t.paymoney;if(0==n)return e.showModal({title:"提醒",content:"请先输入消费金额",showCancel:!1}),!1;var a=e.createAnimation({duration:200,timingFunction:"linear",delay:0});this.animation=a,a.translateY(300).step(),this.animationData=a.export(),this.showModalStatus=!0,setTimeout(function(){a.translateY(0).step(),this.animationData=a.export()}.bind(this),200)},hideModal:function(){var t=e.createAnimation({duration:200,timingFunction:"linear",delay:0});this.animation=t,t.translateY(300).step(),this.animationData=t.export(),setTimeout(function(){t.translateY(0).step(),this.animationData=t.export(),this.showModalStatus=!1}.bind(this),200)},getshopsbase:function(){var t=this;e.request({url:t.$baseurl+"doPagegetshopsbase",data:{uniacid:t.$uniacid,sid:t.sid},success:function(e){t.shopsbase=e.data.data}})}}};t.default=i}).call(this,n("5486")["default"])},ecec:function(e,t,n){"use strict";var a={auth:()=>Promise.all([n.e("common/vendor"),n.e("components/auth/auth")]).then(n.bind(null,"a32a")),bindPhone:()=>Promise.all([n.e("common/vendor"),n.e("components/bindPhone/bindPhone")]).then(n.bind(null,"9bb9")),copyright:()=>n.e("components/copyright/copyright").then(n.bind(null,"cb0f")),myfooter:()=>n.e("components/myfooter/myfooter").then(n.bind(null,"6bab"))},i=function(){var e=this,t=e.$createElement;e._self._c},o=[];n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return a})},f700:function(e,t,n){"use strict";n.r(t);var a=n("ecec"),i=n("5699");for(var o in i)"default"!==o&&function(e){n.d(t,e,function(){return i[e]})}(o);n("fa5c");var s,r=n("f0c5"),c=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],s);t["default"]=c.exports},fa5c:function(e,t,n){"use strict";var a=n("5ab0"),i=n.n(a);i.a}},[["4383","common/runtime","common/vendor"]]]);