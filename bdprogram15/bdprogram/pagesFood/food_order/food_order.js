(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesFood/food_order/food_order"],{1019:function(e,t,a){"use strict";a.r(t);var i=a("71ff"),n=a("ccd7");for(var o in n)"default"!==o&&function(e){a.d(t,e,function(){return n[e]})}(o);a("f86d");var s,d=a("f0c5"),u=Object(d["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);t["default"]=u.exports},"38ca":function(e,t,a){"use strict";(function(e){a("d28f");i(a("66fd"));var t=i(a("1019"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("5486")["createPage"])},4485:function(e,t,a){},"71ff":function(e,t,a){"use strict";var i={auth:()=>Promise.all([a.e("common/vendor"),a.e("components/auth/auth")]).then(a.bind(null,"a32a")),bindPhone:()=>Promise.all([a.e("common/vendor"),a.e("components/bindPhone/bindPhone")]).then(a.bind(null,"9bb9"))},n=function(){var e=this,t=e.$createElement;e._self._c},o=[];a.d(t,"b",function(){return n}),a.d(t,"c",function(){return o}),a.d(t,"a",function(){return i})},"73de":function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a("88e4"),n={data:function(){return{$imgurl:this.$imgurl,needAuth:!1,needBind:!1,gwc:[],allprice:"",xiansz:!1,chuydate:"请选择日期",chuytime:"请选择时间",address:"",xinxi:{username:"",usertel:"",address:"",userdate:"",usertime:"",userbeiz:""},usname:0,ustel:0,usadd:0,usdate:0,ustime:0,dikou_score:0,dikou_money:0,zf_type:0,zbiao:0,index:-1,zhs:[],shangjbs:[],pro_txt:"",pay_type:1,show_pay_type:0,alipay:1,wxpay:1,zf_money:0,id:0,yue_money:0,wx_money:0}},onPullDownRefresh:function(){var t=this;t.getinfos(),e.stopPullDownRefresh()},onLoad:function(t){var a=this;this._baseMin(this),e.setNavigationBarTitle({title:"餐饮下单"});t.id?(a.id=t.id,a.getOrderInfo()):(e.getStorage({key:"arrkey",success:function(e){e.data&&(a.index=e.data)}}),e.getStorage({key:"foodGwc",success:function(e){a.gwc=e.data}}),e.getStorage({key:"foodTotalPay",success:function(e){a.allprice=e.data}}),e.getStorage({key:"mp_address",success:function(e){a.address=e.data}}));var n=0;t.fxsid&&(a.fxsid=t.fxsid),i.bdLogin(n,function(){a.zhchange(),a.getSjbase()})},methods:{closeAuth:function(){console.log("closeAuth"),this.needAuth=!1,this._checkBindPhone(this)},closeBind:function(){console.log("closeBind"),this.needBind=!1,that.zhchange(),that.getSjbase()},redirectto:function(e){var t=e.currentTarget.dataset.link,a=e.currentTarget.dataset.linktype;this._redirectto(t,a)},zhchange:function(){var t=this,a=t.index;e.request({url:t.$baseurl+"doPageZhchange",data:{uniacid:t.$uniacid},success:function(e){-1==a&&(a=0),console.log(e.data.data.zhs);var i=e.data.data.zhs[a];t.zho=e.data.data,t.zhs=e.data.data.zhs,t.zbiao=i},fail:function(e){}})},bindPickerChange:function(e){var t=this,a=e.detail.value;if(0==a)this.index=e.detail.value,this.zbiao="打包/拼桌";else{var i=t.zhs;this.index=e.detail.value,zbiao=i[a]}},getSjbase:function(){var t=this,a=e.getStorageSync("suid");e.request({url:t.$baseurl+"doPageShangjbs",data:{suid:a,uniacid:t.$uniacid},success:function(e){var a=e.data.data.dk_money,i=e.data.data.dk_score,n=t.allprice,o=e.data.data.jf_gz,s=e.data.data.user_money,d=0,u=0,r=0,c=0,l=0;n>=a?(d=a,u=i,r=n-d,r>s?(l=(r-s).toFixed(2),c=s,r=l):(l=0,c=r,r=r)):(d=n,u=1*n/(1*o["money"])*(1*o["score"]),l=0,c=0,r=0),t.shangjbs=e.data.data,t.usname=e.data.data.usname,t.ustel=e.data.data.ustel,t.usadd=e.data.data.usadd,t.usdate=e.data.data.usdate,t.ustime=e.data.data.ustime,t.dk_money=a,t.dk_score=i,t.dikou_money=d,t.dikou_score=u,t.yue_money=c,t.wx_money=l,t.zf_money=r},fail:function(e){}})},pay:i.throttle(function(t){var a=this,i=e.getStorageSync("suid"),n=a.gwc,o=a.address,s=a.xinxi,d=a.zbiao,u=t.detail.formId;if(void 0==d)return e.showModal({content:"请先选择桌号"}),!1;var r=a.usname,c=a.ustel,l=a.usadd,f=a.usdate,h=a.ustime;if(2==r&&""==s["username"])return!1,e.showModal({title:"提醒",content:"姓名为必填！",showCancel:!1}),!1;var y=/^(((13[0-9]{1})|(14[0-9]{1})|(15[0-9]{1})|(16[0-9]{1})|(17[0-9]{1})|(18[0-9]{1})|(19[0-9]{1}))+\d{8})$/;if(2==c&&""==s["usertel"])return!1,e.showModal({title:"提醒",content:"手机号为必填！",showCancel:!1}),!1;if(!y.test(s["usertel"])&&2==c)return e.showModal({title:"提醒",content:"请输入有效的手机号码！",showCancel:!1}),!1;if(2==l&&""==s["address"])return!1,e.showModal({title:"提醒",content:"地址为必填！",showCancel:!1}),!1;if(2==f&&""==s["userdate"])return!1,e.showModal({title:"提醒",content:"日期为必填！",showCancel:!1}),!1;if(2==h&&""==s["usertime"])return!1,e.showModal({title:"提醒",content:"时间为必填！",showCancel:!1}),!1;a.xiansz=!0;var _=a.allprice,g=a.dikou_money,m=a.dikou_score,p=a.yue_money,x=a.wx_money;if(this.id>0)var v=this.orderinfo.order_id;else v="";if(x>0){i=e.getStorageSync("suid");e.request({url:a.$baseurl+"doPageZhifdingd",data:{suid:i,gwc:JSON.stringify(n),address:o,xinxi:JSON.stringify(s),uniacid:a.$uniacid,zh:d,formId:u,price:_,dikou_score:m,dikou_money:g,wx_money:x,yue_money:p,order_id:v,source:e.getStorageSync("source")},header:{"content-type":"application/json"},success:function(e){a.clearStorage(),a._baidupay(a,x,"food",e.data.data,"/pagesFood/food_my/food_my")}})}else{var w=e.getStorageSync("openid");e.showModal({title:"提示",content:"确认支付,费用将从余额直接扣除!",cancelText:"取消支付",confirmText:"确认支付",success:function(t){if(t.cancel)return!1;e.request({url:a.$baseurl+"doPageZjkk",data:{suid:i,price:_,dikou_score:m,dikou_money:g,wx_money:x,yue_money:p,gwc:JSON.stringify(n),address:o,xinxi:JSON.stringify(s),uniacid:a.$uniacid,zh:d,formId:u,source:e.getStorageSync("source"),openid:w,order_id:v},header:{"content-type":"application/json"},success:function(t){e.showToast({title:"支付成功",icon:"success",duration:2e3,success:function(){a.sendMail_order(t.data.data),a.clearStorage(),e.redirectTo({url:"/pagesFood/food_my/food_my"})}})}})}})}},2e3),showpay:function(){var t=this;e.request({url:this.$baseurl+"doPageGetH5payshow",data:{uniacid:this.$uniacid,suid:e.getStorageSync("suid")},success:function(a){0==a.data.data.ali&&0==a.data.data.wx?e.showModal({title:"提示",content:"请联系管理员设置支付参数",success:function(t){e.redirectTo({url:"/pages/index/index"})}}):(0==a.data.data.ali?(t.alipay=0,t.pay_type=2):(t.alipay=1,t.pay_type=1),0==a.data.data.wx?t.wxpay=0:t.wxpay=1,t.show_pay_type=1)}})},changealipay:function(){this.pay_type=1},changewxpay:function(){this.pay_type=2},close_pay_type:function(){this.show_pay_type=0},h5topay:function(){var e=this.pay_type;1==e?this._alih5pay(this,this.zf_money,12,this.orderid):2==e&&this._wxh5pay(this,this.zf_money,"food",this.orderid),this.show_pay_type=0},clearStorage:function(){this.totalPay=0,this.totalNum=0,this.chooseGoodArr=[],e.setStorage({key:"foodGwc",data:this.chooseGoodArr}),e.setStorage({key:"foodTotalPay",data:this.totalPay}),e.setStorage({key:"foodTotalNum",data:this.totalNum})},sendMail_order:function(t){var a=this;e.request({url:a.$baseurl+"doPagesendMail_foodorder",data:{order_id:t,uniacid:a.$uniacid},success:function(e){},fail:function(e){}})},userNameInput:function(e){var t=this,a=t.xinxi,i=e.detail.value;a["username"]=i,t.xinxi=a},userTelInput:function(e){var t=this,a=t.xinxi,i=e.detail.value;a["usertel"]=i,t.xinxi=a},userAddInput:function(e){var t=this,a=t.xinxi,i=e.detail.value;a["address"]=i,t.xinxi=a},bindDateChange:function(e){var t=this,a=t.xinxi,i=e.detail.value;a["userdate"]=i,t.xinxi=a,t.chuydate=i},bindTimeChange:function(e){var t=this,a=t.xinxi,i=e.detail.value;a["usertime"]=i,t.xinxi=a,t.chuytime=i},userTextInput:function(e){var t=this,a=t.xinxi,i=e.detail.value;a["userbeiz"]=i,t.xinxi=a},switch1Change:function(e){var t=this,a=t.dk_score,i=t.dk_money,n=0,o=0,s=0,d=0,u=0,r=t.shangjbs.user_money,c=t.allprice;e.detail.value?(u=c-i,u>r?(u=(u-r).toFixed(2),s=u,d=r):(u=u.toFixed(2),s=0,d=u),n=i,o=a):(c>=r?(s=(c-r).toFixed(2),u=s,d=r):(s=0,u=c,d=c),t.dikou_score=0,t.dikou_money=0),t.dikou_money=n,t.dikou_score=o,t.yue_money=d,t.wx_money=s,t.zf_money=u},getOrderInfo:function(){var t=this,a=this.id;e.request({url:this.$baseurl+"doPageGetOrderInfo",data:{id:a},success:function(e){t.orderinfo=e.data.data,t.gwc=e.data.data.val,t.allprice=e.data.data.price}})}}};t.default=n}).call(this,a("5486")["default"])},ccd7:function(e,t,a){"use strict";a.r(t);var i=a("73de"),n=a.n(i);for(var o in i)"default"!==o&&function(e){a.d(t,e,function(){return i[e]})}(o);t["default"]=n.a},f86d:function(e,t,a){"use strict";var i=a("4485"),n=a.n(i);n.a}},[["38ca","common/runtime","common/vendor"]]]);